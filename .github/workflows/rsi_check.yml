name: Daily RSI Check

on:
  schedule:
    # 北京时间 09:00 - 15:00 每小时运行一次 (UTC 01:00 - 07:00)
    - cron: '0 1-7 * * *'
  workflow_dispatch: # 允许手动触发

jobs:
  check-rsi:
    runs-on: ubuntu-latest
    permissions:
      contents: write  # 授予写入权限以推送到 gh-pages 分支
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v3

    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.9'

    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install requests beautifulsoup4

    - name: Run RSI Check
      env:
        SENDER_EMAIL: ${{ secrets.SENDER_EMAIL }}
        SENDER_PASSWORD: ${{ secrets.SENDER_PASSWORD }}
        SUBSCRIBER_EMAILS: ${{ secrets.SUBSCRIBER_EMAILS }}
        SERVERCHAN_KEY: ${{ secrets.SERVERCHAN_KEY }}
        # 如果使用非QQ邮箱，可以在 Secrets 中配置 SMTP_SERVER 和 SMTP_PORT
        # SMTP_SERVER: ${{ secrets.SMTP_SERVER }}
        # SMTP_PORT: ${{ secrets.SMTP_PORT }}
      run: python github_action_runner.py

    - name: Deploy to GitHub Pages
      uses: peaceiris/actions-gh-pages@v3
      with:
        github_token: ${{ secrets.GITHUB_TOKEN }}
        publish_dir: ./public
        force_orphan: true
